<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <!-- <ion-back-button slot="start" default-href="/layout/home"></ion-back-button>
    <ion-title>Blood-Requests</ion-title> -->
    <ion-grid>
      <ion-row class="ion-justify-content-center ion-align-items-center">
        <ion-col size="1" class="ion-margin-end">
          <ion-back-button default-href="/layout/home"></ion-back-button>
        </ion-col>
        <ion-col size="6">
          <ion-title class="ion-no-padding">Blood-Requests</ion-title>
        </ion-col>
        <ion-col size="2">
          <img class="filter-btn" src="../../../../../assets/filter.png" alt="filter" id="blood-modal" expand="block"  >
          <ion-content class="ion-padding">
            <ion-modal trigger="blood-modal" (willDismiss)="onWillDismiss($event)">
              <ng-template>
                <ion-header>
                  <ion-toolbar color="primary" style="display: flex; justify-content: space-between; align-items: center;">
                    <ion-title style="flex-grow: 1; text-align: start;">Apply Filter</ion-title>
                    <ion-buttons slot="end" style="position: absolute; right: 0;">
                      <ion-button style="font-size: 14px;"  (click)="cancel()">Cancel</ion-button>
                    </ion-buttons>
                  </ion-toolbar>                  
                </ion-header>
                <ion-content class="ion-padding">
                  <ion-item>
                    <ion-grid>
                      <ion-row class="ion-padding-bottom">
                        <ion-label>Blood Group</ion-label>
                      </ion-row>
                      <ion-row class="ion-padding-bottom">
                        <ion-button 
                          size="small" 
                          fill="outline" 
                          *ngFor="let group of bloodGroup" 
                          [ngClass]="{'selected': selectedBloodGroups.includes(group)}"
                          (click)="toggleBloodGroup(group)">
                          {{group}}
                        </ion-button>
                      </ion-row>
                      <ion-row class="ion-padding-bottom">
                        <ion-label>Blood Type</ion-label>
                      </ion-row>
                      <ion-row class="ion-padding-bottom">
                        <ion-button 
                          size="small" 
                          fill="outline" 
                          *ngFor="let type of bloodType" 
                          [ngClass]="{'selected': selectedBloodTypes.includes(type)}"
                          (click)="toggleBloodType(type)">
                          {{type}}
                        </ion-button>
                      </ion-row>
                      <ion-row class="ion-padding-bottom">
                        <ion-label>Hospital Name</ion-label>
                      </ion-row>
                      <ion-row class="ion-padding-bottom">
                        <ion-col size="12">
                          <ion-item class="input-class mt-3" lines="none">
                            <ion-input label-placement="stacked" type="text" placeholder="Enter Hospital Name Here" [(ngModel)]="hospitalName">
                            </ion-input>
                          </ion-item>
                        </ion-col>
                      </ion-row>
                
                    </ion-grid>
                  </ion-item>
                </ion-content>
                <ion-footer>
                  <ion-toolbar>
                    <ion-grid>
                      <ion-row class="ion-padding-horizontal">
                        <ion-col class="ion-text-center">
                          <ion-button expand="block" (click)="clearSelections()">
                            Clear
                          </ion-button>
                        </ion-col>
                        <ion-col  class="ion-text-center">
                          <ion-button expand="block" (click)="confirm()" [strong]="true">
                            Confirm
                          </ion-button>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-toolbar>
                </ion-footer>
              </ng-template>
            </ion-modal>
          </ion-content>
        </ion-col>
        <ion-col size="2" (click)="refreshData()">
          <img class="refresh-btn" src="../../../../../assets/new-refresh.png" alt="">
        </ion-col>

      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="loader; else otherContent">
    <app-skeleton></app-skeleton>
  </div>
  <ng-template #otherContent>
    <div>
      <ion-item class="mt-2" lines="none">
        <ion-segment [(ngModel)]="activeSegment" [scrollable]="true">
          <ion-segment-button value="list" *ngIf="user.role == 'ADMIN'">
            <ion-label class="ion-text-capitalize">My List</ion-label>
          </ion-segment-button>

          <ion-segment-button value="latest">
            <ion-label class="ion-text-capitalize">Active</ion-label>
          </ion-segment-button>
          <!-- Define Role Below -->
          <ion-segment-button value="history">
            <ion-label *ngIf="user.role != 'ADMIN'" class="ion-text-capitalize"
              >History</ion-label
            >
            <ion-label *ngIf="user.role == 'ADMIN'" class="ion-text-capitalize"
              >History Admin</ion-label
            >
          </ion-segment-button>
        </ion-segment>
      </ion-item>
    <ion-searchbar show-clear-button="always"  [debounce]="1000" (ionInput)="searchResult($event)"></ion-searchbar>

      <div [ngSwitch]="activeSegment">
        <!-- Define Role -->
        <div *ngSwitchCase="'list'">
          <ng-container *ngIf="myListTabDetails.length > 0;else noDataList">
            <ion-card
              *ngFor="let i of myListTabDetails; let j = index"
              (click)="openModel('list',i)"
            >
              <ion-card-content class="ion-no-padding">
                <ion-grid>
                  <ion-row>
                    <ion-col size="3" class="drop">
                      <img
                        src="../../../../../assets/blood-unscreen.gif"
                        alt=""
                      />
                      <ion-card-title>{{i?.bloodGroup}}</ion-card-title>
                    </ion-col>
                    <ion-col size="6">
                      <ion-label class="name">{{i?.name }}</ion-label>
                      <div class="ion-margin-top">
                        <i class="fa-solid fa-location-dot"></i>
                        <ion-label class="donar"
                          >{{i?.district +', '+i?.state}}</ion-label
                        >
                      </div>
                      <div class="ion-margin-top donar-container">
                        <div *ngIf="!!i.donar">
                          <i class="fa-solid fa-user"></i>
                          <ion-label class="donar">Donor</ion-label>
                        </div>
                        <div *ngIf="!i.donar">
                          <i class="fa-solid fa-building-columns"></i>
                          <ion-label class="donar">Blood Bank</ion-label>
                        </div>

                        <div class="ion-padding-start">
                          <i class="fa-solid fa-person-half-dress"></i>
                          <ion-label class="donar">{{i?.gender}}</ion-label>
                        </div>
                      </div>
                    </ion-col>
                    <ion-col  *ngIf="i.status == 'ACCEPTED'" size="3" class="ion-text-end ion-align-items-center">
                      <ion-button
                      *ngIf="i.status == 'ACCEPTED'"
                      (click)="statusChange($event,i,j,'PENDING')"
                    >
                      Revert</ion-button>
                    </ion-col>
                    <ion-col  *ngIf="i.status == 'RECEIVED'" size="3" class="ion-text-end ion-align-items-center">
                      
                      <ion-button
                      *ngIf="i.status == 'RECEIVED'"
                      (click)="statusChange($event,i,j,'DONE')"
                    >
                      Done</ion-button>
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col size="12" class="ion-text-end ion-align-items-center">
                    <ion-label class="align-status" *ngIf="i?.status != 'RECEIVED'"
                    [ngClass]="{'status-pending': i?.status == 'PENDING','status-allocated' : i?.status == 'ALLOCATED','status-received': i.status== 'RECEIVED','status-done' : i?.status == 'DONE','status-accepted' : i.status == 'ACCEPTED' ,'statusdoclose': i.status=='CLOSE'}"
                    >{{i?.status}}</ion-label>
                  </ion-col>
                  </ion-row>
                </ion-grid>
              </ion-card-content>
            </ion-card>
          </ng-container>
          <ng-template #noDataList>
            <app-no-data></app-no-data>
          </ng-template>
        </div>
        <div *ngSwitchCase="'latest'">
          <ng-container *ngIf="latestTabDetails.length > 0;else noDataLatest">
            <ion-card
              *ngFor="let l of latestTabDetails"
              (click)="openModel('latest',l)"
            >
              <ion-card-content class="ion-no-padding">
                <ion-grid>
                  <ion-row>
                    <ion-col size="3" class="drop ion-no-padding ">
                      <img
                        src="../../../../../assets/blood-unscreen.gif"
                        alt=""
                      />
                      <ion-card-title>{{l?.bloodGroup}}</ion-card-title>
                    </ion-col>
                    <ion-col size="6" class="ion-no-padding">
                      <ion-label class="name">{{l?.name}}</ion-label>
                      <div class="ion-margin-top">
                        <i class="icons-img fa-solid fa-location-dot"></i>
                        <ion-label class="donar"
                          >{{l?.district +', '+l?.state}}</ion-label
                        >
                      </div>
                      <div class="ion-margin-top donar-container">
                        <div *ngIf="!!l.donar">
                          <i class="fa-solid fa-user"></i>
                          <ion-label class="donar">Donor</ion-label>
                        </div>
                        <div *ngIf="!l.donar">
                          <i class="fa-solid fa-building-columns"></i>
                          <ion-label class="donar">Blood Bank</ion-label>
                        </div>
                        <div class="ion-padding-start">
                          <i
                            class="icons-img fa-solid fa-person-half-dress"
                          ></i>
                          <ion-label class="donar">{{l?.gender}}</ion-label>
                        </div>
                      </div>
                    </ion-col>
                    <ion-col
                      class="ion-text-end"
                      *ngIf="user.role == 'ADMIN' &&  l.status == 'PENDING'"
                    >
                      <ion-button (click)="accept($event,l,'ACCEPTED')">
                        Accept
                      </ion-button>
                      
                    </ion-col>
                    <ion-col
                      class="ion-text-start"
                      *ngIf="l.status != 'PENDING' && !!l.acceptor"
                    >
                      <ion-label class="name">
                        <ion-badge slot="start">{{l.acceptor.firstName | uppercase}}</ion-badge>
                      </ion-label>
                    </ion-col>
                   
                  </ion-row>
                  <ion-row class="ion-justify-content-end">
                    <ion-col size="3" class=" ion-text-center ion-no-padding"
                    [ngClass]="{'status-pending': l?.status == 'PENDING','status-allocated' : l?.status == 'ALLOCATED','status-received': l.status== 'RECEIVED','status-done' : l?.status == 'DONE','status-accepted' : l.status == 'ACCEPTED' ,'statusdoclose': l.status=='CLOSE'}"
                  >
                    <ion-label class="">{{l?.status}}    </ion-label>
                  </ion-col>
                    
                    <!-- <ion-col
                      class="ion-text-end"
                      *ngIf="l.status != 'PENDING' && !!l.acceptor"
                    >
                      <ion-label class="name">
                        {{l.acceptor.firstName}} {{l.acceptor.lastName}}
                      </ion-label>
                    </ion-col> -->
                  </ion-row>
                </ion-grid>
              </ion-card-content>
            </ion-card>
          </ng-container>
          <ng-template #noDataLatest>
            <app-no-data></app-no-data>
          </ng-template>
        </div>
        <div *ngSwitchCase="'history'">
        
          <ng-container *ngIf="historyTabDetails.length > 0;else noDataHistory">
            <ion-card
              *ngFor="let h of historyTabDetails"
              (click)="openModel('history',h)"
            >
              <ion-card-content class="ion-no-padding">
                <ion-grid>
                  <ion-row>
                    <ion-col size="3" class="drop">
                      <img
                        src="../../../../../assets/blood-unscreen.gif"
                        alt=""
                      />
                      <ion-card-title>{{h?.bloodGroup}}</ion-card-title>
                    </ion-col>
                    <ion-col size="6">
                      <ion-label class="name">{{h?.name }}</ion-label>
                      <div class="ion-margin-top">
                        <i class="icons-img fa-solid fa-location-dot"></i>
                        <ion-label class="donar"
                          >{{h?.city +', '+h?.state}}</ion-label
                        >
                      </div>
                      <div class="ion-margin-top donar-container">
                        <div>
                          <i class="fa-solid fa-user"></i>
                          <ion-label class="donar">Donor</ion-label>
                        </div>
                        <div class="ion-padding-start">
                          <i
                            class="icons-img fa-solid fa-person-half-dress"
                          ></i>
                          <ion-label class="donar">{{h?.gender}}</ion-label>
                        </div>
                      </div>
                    </ion-col>
                    <!-- <ion-col size="3" class="btn-col">
                <ion-button class="detail-btn" (click)="openModel()">
                  View Details
                </ion-button>
              </ion-col> -->
                  </ion-row>
                  <ion-row class="ion-justify-content-end">
                    <ion-label>{{h?.bloodRequireDate}}</ion-label>
                  </ion-row>
                </ion-grid>
              </ion-card-content>
            </ion-card>
          </ng-container>
          <ng-template #noDataHistory>

            <app-no-data></app-no-data>
          </ng-template>
        </div>
      </div>
    </div>
    <ion-infinite-scroll (ionInfinite)="doInfinite($event)">
      <ion-infinite-scroll-content loadingText="Please wait..." loadingSpinner="bubbles"></ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </ng-template>
</ion-content>
